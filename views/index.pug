doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title Login
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css")

  body.bg-light.d-flex.align-items-center.justify-content-center.vh-100
    .container
      .row.justify-content-center
        .col-md-6
          .card.shadow
            .card-body
              h2.text-center.mb-4 Login
              form(method="POST", action="../src/login/login.php")
                .mb-3
                  label.form-label(for="email") Email
                  input#email.form-control(type="text", name="email", required)

                .mb-3
                  label.form-label(for="password") Password
                  input#password.form-control(type="password", name="password", required)

                button.btn.btn-primary.w-100(type="submit") Login
    .script 
      script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js")
      script.
        const form = document.querySelector('form')
        form.addEventListener('submit', event => {
          event.preventDefault()
          const email = document.querySelector('#email').value
          const password = document.querySelector('#password').value
          if (email && password) {
            fetch('/auth/login', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ email, password }),
            })
            .then(response => {
              // Check the response status
              if (response.ok) {
                return response.json();
              } else {
                return response.json().then(data => {
                  throw new Error(data.message || 'Credenciales inválidas')
                });
              }
            })
            .then(data => {
              if (data.message === "Login correcto") {
                window.location.href = data.redirect
              } else {
                alert('Error de servidor')
              }
            })
            .catch(error => {
              console.error('Error:', error)
              alert(error.message || 'Error de conexión')
            })
          } else {
            alert('Por favor, rellena todos los campos')
          }
        })

  
